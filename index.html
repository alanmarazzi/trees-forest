<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Don&#39;t get lost in a forest by alanmarazzi</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Don&#39;t get lost in a forest</h1>
        <h2>Reference repo for &quot;Don&#39;t get lost in a forest&quot; post</h2>
        <a href="https://github.com/alanmarazzi/trees-forest" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="dont-get-lost-in-a-forest" class="anchor" href="#dont-get-lost-in-a-forest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Don't get lost in a forest</h1>

<p>Reference for "Don't get lost in a forest" post on <a href="http://rdisorder.eu">rdisorder.eu</a></p>

<p>This will be an intro to tree-based models in R.</p>

<h2>
<a id="work-in-progress" class="anchor" href="#work-in-progress" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Work in progress</h2>

<p>The project will be ready by the end of 2016
 
 </p>

<h3>
<a id="in-the-meantime-you-can-get-a-look-at-the-brief-intro-below" class="anchor" href="#in-the-meantime-you-can-get-a-look-at-the-brief-intro-below" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>In the meantime you can get a look at the brief intro below</h3>

<p> </p>

<h1>
<a id="fast--brief-primer-on-dplyr--intubate" class="anchor" href="#fast--brief-primer-on-dplyr--intubate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Fast &amp; brief primer on dplyr + intubate</h1>

<p>This is a short intro to <code>dplyr</code> and <code>intubate</code> packages. I didn't want to load too much the <strong>Don't get lost in a forest post</strong> this intro is referring to.</p>

<h2>
<a id="why-dplyr-and-not-base-r" class="anchor" href="#why-dplyr-and-not-base-r" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why dplyr and not base R?</h2>

<p>With <code>dplyr</code> we can avoid the creation of temporary datasets saving computation time and memory. It might look trivial, but you'll realize this approach not only will save a ton of time in the long-run, but it will also improve code clarity and simplicity.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">dplyr</span>)</pre></div>

<pre><code>## 
## Attaching package: 'dplyr'

## The following objects are masked from 'package:stats':
## 
##     filter, lag

## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</code></pre>

<div class="highlight highlight-source-r"><pre>head(<span class="pl-smi">iris</span>)</pre></div>

<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
</code></pre>

<p>Now let's say I want to see the mean of every species, how would I do?</p>

<div class="highlight highlight-source-r"><pre>tapply(<span class="pl-smi">iris</span><span class="pl-k">$</span><span class="pl-smi">Petal.Width</span>, <span class="pl-smi">iris</span>[,<span class="pl-c1">5</span>], <span class="pl-smi">mean</span>)</pre></div>

<pre><code>##     setosa versicolor  virginica 
##      0.246      1.326      2.026
</code></pre>

<p>This is a very nice <em>one-liner</em> and for basic stuff like this is actually the best way to deal with grouping. But what if I want the mean of every variable at the same time?</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">iris</span> %<span class="pl-k">&gt;</span>% <span class="pl-c"># Take iris data set</span>
    group_by(<span class="pl-smi">Species</span>) %<span class="pl-k">&gt;</span>% <span class="pl-c"># group everything by Species</span>
    summarize_each(funs(<span class="pl-smi">mean</span>)) <span class="pl-c"># summarize each group with the funs I want</span></pre></div>

<pre><code>## # A tibble: 3 × 5
##      Species Sepal.Length Sepal.Width Petal.Length Petal.Width
##       &lt;fctr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1     setosa        5.006       3.428        1.462       0.246
## 2 versicolor        5.936       2.770        4.260       1.326
## 3  virginica        6.588       2.974        5.552       2.026
</code></pre>

<p>Et voilà! And the result is a convenient <em>tibble</em> which is a dataframe 2.0 and you can use the same as a base dataframe.</p>

<p>Moreover, piping makes reading code more natural, just look at the comments in the code chunk above.</p>

<h2>
<a id="why-intubate" class="anchor" href="#why-intubate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why intubate?</h2>

<p>Don't think this is enough, with the <code>intubate</code> package we can go even further and pipe models as well.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">intubate</span>)

summary(lm(<span class="pl-smi">Petal.Width</span> <span class="pl-k">~</span> ., <span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">iris</span>[sample(<span class="pl-c1">1</span><span class="pl-k">:</span>nrow(<span class="pl-smi">iris</span>), nrow(<span class="pl-smi">iris</span>) <span class="pl-k">*</span> .<span class="pl-c1">7</span>), <span class="pl-k">-</span> <span class="pl-c1">5</span>]))</pre></div>

<pre><code>## 
## Call:
## lm(formula = Petal.Width ~ ., data = iris[sample(1:nrow(iris), 
##     nrow(iris) * 0.7), -5])
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.37386 -0.12411 -0.01595  0.08865  0.54763 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.05771    0.19494  -0.296    0.768    
## Sepal.Length -0.25555    0.05048  -5.063 1.86e-06 ***
## Sepal.Width   0.23180    0.05419   4.277 4.30e-05 ***
## Petal.Length  0.54363    0.02651  20.503  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1818 on 101 degrees of freedom
## Multiple R-squared:  0.9462, Adjusted R-squared:  0.9446 
## F-statistic: 591.7 on 3 and 101 DF,  p-value: &lt; 2.2e-16
</code></pre>

<p>The <em>one-liner</em> above is a mouthful and not so clear. One way to make the same thing more clearly would be to create copies and lookup variables, but we don't like that much right?</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">iris</span> %<span class="pl-k">&gt;</span>% <span class="pl-c"># Take iris data set</span>
    select(<span class="pl-k">-</span><span class="pl-smi">Species</span>) %<span class="pl-k">&gt;</span>% <span class="pl-c"># keep all columns except Species</span>
    sample_n(nrow(<span class="pl-smi">iris</span>) <span class="pl-k">*</span> .<span class="pl-c1">7</span>) %<span class="pl-k">&gt;</span>% <span class="pl-c"># take a random sample of rows</span>
    ntbt_lm(<span class="pl-smi">Petal.Width</span> <span class="pl-k">~</span> .) %<span class="pl-k">&gt;</span>% <span class="pl-c"># run a linear regression</span>
    <span class="pl-smi">summary</span> <span class="pl-c"># show me a summary</span></pre></div>

<pre><code>## 
## Call:
## lm(formula = Petal.Width ~ ., data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.61250 -0.09824 -0.02436  0.10692  0.60443 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.25337    0.22534  -1.124 0.263506    
## Sepal.Length -0.21542    0.05656  -3.809 0.000240 ***
## Sepal.Width   0.23909    0.06015   3.975 0.000132 ***
## Petal.Length  0.52827    0.02883  18.320  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1959 on 101 degrees of freedom
## Multiple R-squared:  0.935,  Adjusted R-squared:  0.9331 
## F-statistic: 484.2 on 3 and 101 DF,  p-value: &lt; 2.2e-16
</code></pre>

<p>Much clearer and makes doing transformations before running a model feel like a breeze. If you want to use a function not included in the <code>intubate</code> package, or if you're not sure if it's implemented or not you can use it with the simple <code>ntbt</code> framework.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">iris</span> %<span class="pl-k">&gt;</span>% <span class="pl-c"># Take iris data set</span>
    select(<span class="pl-k">-</span><span class="pl-smi">Species</span>) %<span class="pl-k">&gt;</span>% <span class="pl-c"># keep all columns except Species</span>
    sample_n(nrow(<span class="pl-smi">iris</span>) <span class="pl-k">*</span> .<span class="pl-c1">7</span>) %<span class="pl-k">&gt;</span>% <span class="pl-c"># take a random sample of rows</span>
    ntbt(<span class="pl-smi">lm</span>, <span class="pl-smi">Petal.Width</span> <span class="pl-k">~</span> .) %<span class="pl-k">&gt;</span>% <span class="pl-c"># run a linear regression</span>
    <span class="pl-smi">summary</span> <span class="pl-c"># show me a summary</span></pre></div>

<pre><code>## 
## Call:
## lm(formula = Petal.Width ~ ., data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.40603 -0.10177 -0.00889  0.08524  0.60071 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.21301    0.20300  -1.049    0.297    
## Sepal.Length -0.22614    0.05502  -4.110 8.06e-05 ***
## Sepal.Width   0.23660    0.05713   4.142 7.17e-05 ***
## Petal.Length  0.53710    0.02758  19.472  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1811 on 101 degrees of freedom
## Multiple R-squared:  0.9454, Adjusted R-squared:  0.9437 
## F-statistic: 582.4 on 3 and 101 DF,  p-value: &lt; 2.2e-16
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/alanmarazzi/trees-forest/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/alanmarazzi/trees-forest/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/alanmarazzi/trees-forest"></a> is maintained by <a href="https://github.com/alanmarazzi">alanmarazzi</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
